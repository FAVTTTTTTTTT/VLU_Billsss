function validateOnlinePaymentAttempt(){if("0"===$("#totalAmount").text())return $("#alertModal").find(".modal-body").text(errMsgNoDebts),$("#alertModal").modal({backdrop:!0}),!1;var e="1"===$(".debtSelector:checked").first().attr("data-collection-fee-type"),t=!0;return $(".debtSelector:checked").each((function(o){"1"!==$(this).attr("data-collection-fee-type")&&e&&(t=!1),"1"!==$(this).attr("data-collection-fee-type")||e||(t=!1)})),t?(checkTargetProviderIsSelected(),1!==$("#payment-provider-list>li.active.disabled").length||($("#alertModal").find(".modal-body").text("Xin lỗi, nhà cung cấp thanh toán này hiện không có sẵn"),$("#alertModal").modal({backdrop:!0}),!1)):($("#alertModal").find(".modal-body").text("Vui lòng chọn thanh toán cùng một loại phí !"),$("#alertModal").modal({backdrop:!0}),!1)}function validateTopupPaymentAttempt(){return checkTargetProviderIsSelected()}function checkTargetProviderIsSelected(){return 0!==$("#payment-provider-list>li.active").length||($("#alertModal").find(".modal-body").text(errMsgNoProviders),$("#alertModal").modal({backdrop:!0}),!1)}function validateTopupValue(e){}function validateValueIsNumeric(e){return!isNaN(e)||($("#alertModal").find(".modal-body").text(errMsgNotNumber),$("#alertModal").modal({backdrop:!0}),!1)}function initDebtCheckboxes(){$(".debtSelector[checked]").each((function(){$(this).prop("checked",!0)}))}function sendSms(){if($(".created-invoice input.email").hide(),$(".created-invoice input.sms").is(":visible")){var e=$("#payment-provider-list>li.active").children("a").data("provider-code"),t=$(".created-invoice input.sms").val();$.ajax({type:"POST",url:"/Pay/SendCreatedInvoiceSms/"+$(".invoice-num").text()+"?provider="+e+"&phone="+t,contentType:"application/json"}).done((function(e){console.log("send invoice by sms:"+e)}))}$(".created-invoice input.sms").toggle()}function sendEmail(){if($(".created-invoice input.sms").hide(),$(".created-invoice input.email").is(":visible")){var e=$("#payment-provider-list>li.active").children("a").data("provider-code"),t=$(".created-invoice input.email").val();$.ajax({type:"POST",url:"/Pay/SendCreatedInvoiceEmail/"+$(".invoice-num").text()+"?provider="+e+"&email="+t,contentType:"application/json"}).done((function(e){console.log("send invoice by email:"+e)}))}$(".created-invoice input.email").toggle()}function showOfflineCreatedInvoiceInfo(e){$(".invoice-num").text(e.code),$(".invoice-amount").text(numberWithDots(e.total)),"hnue"==e.merchantCode&&(document.getElementById("codeForScan").style.visibility="hidden"),$("#invoiceNumBarcode").attr("src","https://barcode.tec-it.com/barcode.ashx?code=Code128&dpi=96&dataseparator=200x100cht=qr&chl=&data="+e.code),$("#invoiceNumQrCode").attr("src","https://chart.apis.google.com/chart?cht=qr&chs=150x150&chl="+e.code),$(".invoice-expired").text(moment(e.expired).local().format("DD/MM/YYYY HH:mm")),$(".created-invoice").toggle(),$("#btn-sms").click(sendSms),$(".created-invoice-send a.email").click(sendEmail)}function showOfflinePaymentInstructions(e,t){var o=`https://pscebillinfo.azurewebsites.net/invoiceinfo.html?isdev=false&bank=${t}&num=${e.code}&total=${numberWithDots(e.total)}&customerName=${e.customerName}&expired=`+moment(e.expired).local().format("DD/MM/YYYY HH:mm");$("#offlineInvoiceInstructionsIframe").attr("src",o)}function processCreatedInvoice(e){var t=getSelectedPaymentMethod(),o=e.paymentURL.filter((e=>e.paymentProfileId===t.paymentMethodId));if("MB"===t.providerCode&&"Online"===t.invoiceType)return $("#checkout-form-pay-link").val(o[0].href),void $("#checkoutFormModal").modal({backdrop:!0});if(o.length>0&&0===o[0].invoiceType&&(window.location=o[0].href),o.length>0&&2===o[0].invoiceType)$.ajax({type:"GET",url:o[0].href}).done((function(e){var t=JSON.parse(e);new QRCodeStyling({width:300,height:300,data:t.qr,dotsOptions:{color:"#4267b2",type:"rounded"},backgroundOptions:{color:"#e9ebee"},imageOptions:{crossOrigin:"anonymous",margin:20}}).append(document.getElementById("qr-canvas")),$("#qrModal").modal({backdrop:!0});var o=setInterval(examinePaymentStatus,5e3,t.code);setTimeout(clearInterval,3e5,o)}));else if(currentInvoiceNum=e.code,currentInvoiceData=e,t.qrPayAvailable&&t.providerCode){let o=`https://pscebillinfo.azurewebsites.net/invoiceqrpay.html?num=${e.code}&bank=${t.providerCode}`;$("#offlineInvoiceInstructionsIframe").attr("src",o),$("#offlineInvoiceInstructionsModal").modal({backdrop:!0})}else showOfflineCreatedInvoiceInfo(e)}function createInvoice(e,t){$.ajax({type:"POST",url:e,data:JSON.stringify(t),contentType:"application/json",dataType:"json"}).done((function(e){$(".debtSelector:checked").each((function(e){$(this).prop("checked",!1),$(this).prop("disabled",!0),$(this).closest("div.row").addClass("disabled-container")})),processCreatedInvoice(e)})).fail((function(e){$("#alertModal").find(".modal-body").text("error: "+e.statusText),$("#alertModal").modal({backdrop:!0})}))}function createTopup(e){$.ajax({type:"POST",url:e}).done((function(e){$("#topupModal").modal("hide"),processCreatedInvoice(e)})).fail((function(e){$("#alertModal").find(".modal-body").text("error: "+e.statusText),$("#alertModal").modal({backdrop:!0})}))}function offlinePaymentInstruction(e){if(!currentInvoiceData)return $("#alertModal").find(".modal-body").html("Vui lòng tạo mã thanh toán trước!<br/>Chọn 'Mã thanh toán' rồi nhấn nút 'Tạo mã'."),$("#alertModal").modal({backdrop:!0}),!1;showOfflinePaymentInstructions(currentInvoiceData,e),$("#offlineInvoiceInstructionsModal").modal({backdrop:!0})}function invoiceDetail(e){let t=`https://pscebillinfo.azurewebsites.net/InvoiceDetail.html?id=${e}`;$("#offlineInvoiceInstructionsIframe").attr("src",t),$("#offlineInvoiceInstructionsModal").modal({backdrop:!0})}function getSelectedPaymentMethod(){var e=$("#payment-provider-list>li.active").children("a");return e?{providerCode:e.data("provider-code"),invoiceType:e.data("invoice-type"),paymentMethodId:e.data("payment-method-id"),qrPayAvailable:e.data("pay-by-qr")}:null}function examinePaymentStatus(e){$.ajax({type:"POST",url:"/pay/status/"+e}).done((function(e){!0===e.isCompleted&&(window.location=e.redirectUrl)}))}$("#debtsModal").on("hidden.bs.modal",(function(){var e=0;$(".debtSelector:checked").each((function(){e+=parseFloat($(this).val())})),$("#totalAmount").text(numberWithDots(e))})),$("#checkoutFormModal").on("submit","#checkoutForm",(function(e){e.preventDefault();var t=$(this);$.ajax({url:t.attr("action"),method:t.attr("method"),data:t.serialize(),success:function(e){$("#checkoutForm .alert-danger").html(e.error),e.error?$("#checkoutForm .alert-danger").show():$("#checkoutForm .alert-danger").hide(),e.requestId&&($("#checkout-form-request-id").val(e.requestId),$("#checkoutForm .account-form-field").hide(),$("#checkoutForm .otp-form-field").show(),e.paymentRef&&$("#checkout-form-payment-ref").val(e.paymentRef)),e.otp&&($("#checkoutForm .otp-form-field").hide(),$("#checkoutForm button[type='submit']").hide(),e.error||($("#checkoutForm .alert-success").html("Payment "+e.paymentRef+" is successfull"),$("#checkoutForm .alert-success").show()))},error:function(e,t){var o=e.responseText,n=o.indexOf("#MBError#");if(n>0){var a=o.indexOf("!MBError!"),i=o.substring(n+9,a);$("#checkoutForm .alert-danger").html(i),$("#checkoutForm .alert-danger").show()}}})})),$(".banks-offline .li-bank").on("click",(function(e){const t=$(e.currentTarget);showOfflinePaymentInstructions(currentInvoiceData,t.data("provider-code")),$("#offlineInvoiceInstructionsModal").modal({backdrop:!0})}));